{% if
    gitlab_ci_nginx_enable is defined or
    gitlab_ci_nginx_client_max_body_size is defined or
    gitlab_ci_nginx_redirect_http_to_https is defined or
    gitlab_ci_nginx_redirect_http_to_https_port is defined or
    gitlab_ci_nginx_ssl_certificate_path is defined or
    gitlab_ci_nginx_ssl_certificate_key_path is defined or
    gitlab_ci_nginx_ssl_ciphers is defined or
    gitlab_ci_nginx_ssl_prefer_server_ciphers is defined or
    gitlab_ci_nginx_ssl_protocols is defined or
    gitlab_ci_nginx_ssl_session_cache is defined or
    gitlab_ci_nginx_ssl_session_timeout is defined or
    gitlab_ci_nginx_listen_addresses is defined or
    gitlab_ci_nginx_custom_gitlab_server_config is defined or
    gitlab_ci_nginx_custom_nginx_config is defined or
    gitlab_ci_nginx_dir is defined or
    gitlab_ci_nginx_log_directory is defined or
    gitlab_ci_nginx_worker_processes is defined or
    gitlab_ci_nginx_worker_connections is defined or
    gitlab_ci_nginx_sendfile is defined or
    gitlab_ci_nginx_tcp_nopush is defined or
    gitlab_ci_nginx_tcp_nodelay is defined or
    gitlab_ci_nginx_gzip is defined or
    gitlab_ci_nginx_gzip_http_version is defined or
    gitlab_ci_nginx_gzip_comp_level is defined or
    gitlab_ci_nginx_gzip_proxied is defined or
    gitlab_ci_nginx_gzip_types is defined or
    gitlab_ci_nginx_keepalive_timeout is defined or
    gitlab_ci_nginx_cache_max_size is defined
%}

###################
# GitLab CI Nginx #
###################

{% endif %}
{% if gitlab_ci_nginx_enable is defined %}ci_nginx['enable'] = {{ gitlab_ci_nginx_enable | lower }}
{% endif %}
{% if gitlab_ci_nginx_client_max_body_size is defined %}ci_nginx['client_max_body_size'] = '{{ gitlab_ci_nginx_client_max_body_size }}'
{% endif %}
{% if gitlab_ci_ssl_key is defined or gitlab_ci_nginx_ssl_enabled == True %}
{% if gitlab_ci_nginx_redirect_http_to_https is defined %}ci_nginx['redirect_http_to_https'] = {{ gitlab_ci_nginx_redirect_http_to_https | lower }}
{% endif %}
{% if gitlab_ci_nginx_redirect_http_to_https_port is defined %}ci_nginx['redirect_http_to_https_port'] = {{ gitlab_ci_nginx_redirect_http_to_https_port }}
{% endif %}
{% if gitlab_ci_nginx_ssl_certificate_path is defined %}ci_nginx['ssl_certificate'] = "{{ gitlab_ci_nginx_ssl_certificate_path }}"
{% endif %}
{% if gitlab_ci_nginx_ssl_certificate_key_path is defined %}ci_nginx['ssl_certificate_key'] = "{{ gitlab_ci_nginx_ssl_certificate_key_path }}"
{% endif %}
{% if gitlab_ci_nginx_ssl_ciphers is defined %}ci_nginx['ssl_ciphers'] = "
    {%- for cipher in gitlab_ci_nginx_ssl_ciphers -%}
        {{ cipher }}{% if not loop.last %}:{% endif -%}
    {%- endfor -%}
"
{% endif %}
{% if gitlab_ci_nginx_ssl_prefer_server_ciphers is defined %}ci_nginx['ssl_prefer_server_ciphers'] = "{{ gitlab_ci_nginx_ssl_prefer_server_ciphers }}"
{% endif %}
{% if gitlab_ci_nginx_ssl_protocols is defined %}ci_nginx['ssl_protocols'] = "
    {%- for protocol in gitlab_ci_nginx_ssl_protocols -%}
        {{ protocol }}{% if not loop.last %} {% endif -%}
    {%- endfor -%}
"
{% endif %}
{% if gitlab_ci_nginx_ssl_session_cache is defined %}ci_nginx['ssl_session_cache'] = "{{ gitlab_ci_nginx_ssl_session_cache }}"
{% endif %}
{% if gitlab_ci_nginx_ssl_session_timeout is defined %}ci_nginx['ssl_session_timeout'] = "{{ gitlab_ci_nginx_ssl_session_timeout }}"
{% endif %}
{% endif %}
{% if gitlab_ci_nginx_listen_addresses is defined %}ci_nginx['listen_addresses'] = [
    {%- for address in gitlab_ci_nginx_listen_addresses -%}
        '{{ address }}'{% if not loop.last %}, {% endif -%}
    {%- endfor %}
]
{% endif %}
{% if gitlab_ci_nginx_custom_gitlab_server_config is defined %}ci_nginx['custom_gitlab_server_config'] = "{{ gitlab_ci_nginx_custom_gitlab_server_config }}"
{% endif %}
{% if gitlab_ci_nginx_custom_nginx_config is defined %}ci_nginx['custom_nginx_config'] = "{{ gitlab_ci_nginx_custom_nginx_config }}"
{% endif %}
{% if gitlab_ci_nginx_dir is defined %}ci_nginx['dir'] = "{{ gitlab_ci_nginx_dir }}"
{% endif %}
{% if gitlab_ci_nginx_log_directory is defined %}ci_nginx['log_directory'] = "{{ gitlab_ci_nginx_log_directory }}"
{% endif %}
{% if gitlab_ci_nginx_worker_processes is defined %}ci_nginx['worker_processes'] = {{ gitlab_ci_nginx_worker_processes }}
{% endif %}
{% if gitlab_ci_nginx_worker_connections is defined %}ci_nginx['worker_connections'] = {{ gitlab_ci_nginx_worker_connections }}
{% endif %}
{% if gitlab_ci_nginx_sendfile is defined %}ci_nginx['sendfile'] = '{{ gitlab_ci_nginx_sendfile }}'
{% endif %}
{% if gitlab_ci_nginx_tcp_nopush is defined %}ci_nginx['tcp_nopush'] = '{{ gitlab_ci_nginx_tcp_nopush }}'
{% endif %}
{% if gitlab_ci_nginx_tcp_nodelay is defined %}ci_nginx['tcp_nodelay'] = '{{ gitlab_ci_nginx_tcp_nodelay }}'
{% endif %}
{% if gitlab_ci_nginx_gzip is defined %}ci_nginx['gzip'] = "{{ gitlab_ci_nginx_gzip }}"
{% endif %}
{% if gitlab_ci_nginx_gzip_http_version is defined %}ci_nginx['gzip_http_version'] = "{{ gitlab_ci_nginx_gzip_http_version }}"
{% endif %}
{% if gitlab_ci_nginx_gzip_comp_level is defined %}ci_nginx['gzip_comp_level'] = "{{ gitlab_ci_nginx_gzip_comp_level }}"
{% endif %}
{% if gitlab_ci_nginx_gzip_proxied is defined %}ci_nginx['gzip_proxied'] = "{{ gitlab_ci_nginx_gzip_proxied }}"
{% endif %}
{% if gitlab_ci_nginx_gzip_types is defined %}ci_nginx['gzip_types'] = [
    {%- for type in gitlab_ci_nginx_gzip_types -%}
        "{{ type }}"{% if not loop.last %}, {% endif %}
    {%- endfor %}
]
{% endif %}
{% if gitlab_ci_nginx_keepalive_timeout is defined %}ci_nginx['keepalive_timeout'] = {{ gitlab_ci_nginx_keepalive_timeout }}
{% endif %}
{% if gitlab_ci_nginx_cache_max_size is defined %}ci_nginx['cache_max_size'] = '{{ gitlab_ci_nginx_cache_max_size }}'
{% endif %}